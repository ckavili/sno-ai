apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: snoai-menu-router
  namespace: openshift-gitops
spec:
  goTemplate: true
  generators:
    - merge:
        mergeKeys: ["menu"]          # join on 'menu'
        generators:
          - git:
              repoURL: https://github.com/ckavili/sno-ai.git
              revision: main
              files:
                - path: gitops/menu/config.yaml   # e.g. { menu: "2", git: { repoURL: "...", branch: "main" } }
          - list:
              elements:
                - menu: "1"
                  appPath: gitops/menu-options/option-1
                  name: full-rhoai
                - menu: "2"
                  appPath: gitops/menu-options/option-2
                  name: model-serving-granite
                - menu: "3"
                  appPath: gitops/menu-options/option-3
                  name: llm-serving-llamascout
                - menu: "4"
                  appPath: gitops/menu-options/option-4
                  name: custom-config
  template:
    metadata:
      name: "snoai-{{ .menu }}"
      labels:
        snoai-menu-option: "{{ .menu }}"
    spec:
      project: default
      source:
        repoURL: "{{ .git.repoURL }}"
        targetRevision: "{{ .git.branch }}"
        path: "{{ .appPath }}"
      destination:
        server: https://kubernetes.default.svc
        namespace: redhat-ods-operator
